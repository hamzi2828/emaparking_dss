!function(i){"use strict";new Vue({el:".bravo_space_book_app_"+bravo_booking_data.id,data:{id:"",extra_price:[],person_types:[[]],buyer_fees:[],message:{content:"",type:!1},html:"",onSubmit:!1,start_date:"",end_date:"",start_date_html:"",number_of_guests:0,step:1,start_date_obj:"",adults:1,children:0,allEvents:[],total_price_before_fee:0,total_price_fee:0,is_form_enquiry_and_book:!1,enquiry_type:"book",enquiry_is_submit:!1,enquiry_name:"",enquiry_email:"",enquiry_phone:"",enquiry_note:"",booking_type:"by_day"},watch:{extra_price:{handler:function(){this.step=1},deep:!0},start_date:function(){this.step=1},person_types:{handler:function(){this.step=1},deep:!0},adults:function(){parseInt(this.guests)>bravo_booking_data.max_guests&&(this.adults=parseInt(this.adults)-1)},children:function(){parseInt(this.guests)>bravo_booking_data.max_guests&&(this.children=parseInt(this.children)-1)}},computed:{total_price:function(){var e=this;if(""===e.start_date)return 0;var t=0,a=new Date(e.start_date).getTime(),r=new Date(e.end_date).getTime(),i=!0,s=parseInt(e.children)+parseInt(e.adults);if("by_day"===e.booking_type)for(var n in e.allEvents){var o=e.allEvents[n];a<=(l=new Date(o.start).getTime())&&l<=r&&(t+=parseFloat(o.price),0===o.active&&(i=!1))}var d=moment(r).diff(moment(a),"hours")+24,_=moment(r).diff(moment(a),"days")+1;if("by_night"===e.booking_type){for(var n in e.allEvents){var l,o=e.allEvents[n];a<=(l=new Date(o.start).getTime())&&l<r&&(t+=parseFloat(o.price),0===o.active&&(i=!1))}d-=24,--_}for(n in e.extra_price){var u=0;if(!0===(o=e.extra_price[n]).enable){switch(o.type){case"one_time":u+=parseFloat(o.price);break;case"per_hour":u+=parseFloat(o.price)*Math.max(d,24);break;case"per_day":u+=parseFloat(o.price)*Math.max(1,_)}void 0!==o.per_person&&(u*=s),t+=u}}this.total_price_before_fee=t;var c=0;for(n in e.buyer_fees){var o=e.buyer_fees[n],p=parseFloat(o.price);void 0!==o.unit&&"percent"===o.unit&&(p*=t/100),void 0!==o.per_person&&(p*=s),c+=p}return t+=c,this.total_price_fee=c,!1===i||0===s?0:t},total_price_html:function(){return this.total_price?window.bravo_format_money(this.total_price):""},daysOfWeekDisabled:function(){var e,t=[];for(e in this.open_hours)void 0!==this.open_hours[e].enable&&1==this.open_hours[e].enable||(7==e?t.push(0):t.push(e));return t},guests:function(){return parseInt(this.children)+parseInt(this.adults)},pay_now_price:function(){if(this.is_deposit_ready){var e=0,t=this.total_price,a=this.deposit_fomular;return"deposit_and_fee"===a&&(t=this.total_price_before_fee),e="percent"===this.deposit_type?t*this.deposit_amount/100:this.deposit_amount,"deposit_and_fee"===a&&(e+=this.total_price_fee),e}return this.total_price},pay_now_price_html:function(){return window.bravo_format_money(this.pay_now_price)},is_deposit_ready:function(){return!(!this.deposit||!this.deposit_amount)}},created:function(){for(var e in bravo_booking_data)this[e]=bravo_booking_data[e]},mounted:function(){var r=this,e={showCalendar:!1,sameDate:!0,autoApply:!0,disabledPast:!0,dateFormat:bookingCore.date_format,enableLoading:!0,showEventTooltip:!0,classNotAvailable:["disabled","off"],disableHightLight:!0,minDate:this.minDate,opens:bookingCore.rtl?"right":"left",locale:{direction:bookingCore.rtl?"rtl":"ltr",firstDay:daterangepickerLocale.first_day_of_week},isInvalidDate:function(e){for(var t=0;t<r.allEvents.length;t++){var a=r.allEvents[t];if(a.start==e.format("MM/DD/YYYY"))return!a.active}return!1}};"object"==typeof daterangepickerLocale&&(e.locale=_.merge(daterangepickerLocale,e.locale)),this.$nextTick(function(){i(this.$refs.start_date).daterangepicker(e).on("apply.daterangepicker",function(e,t){"by_night"===r.booking_type&&t.endDate.diff(t.startDate,"day")<=0&&t.endDate.add(1,"day"),r.start_date=t.startDate.format("MM/DD/YYYY"),r.end_date=t.endDate.format("MM/DD/YYYY"),r.start_date_html=t.startDate.format(bookingCore.date_format)+' <i class="fa fa-long-arrow-right" style="font-size: inherit"></i> '+t.endDate.format(bookingCore.date_format)}).on("update-calendar",function(e,t){r.fetchEvents(t.leftCalendar.calendar[0][0],t.rightCalendar.calendar[5][6])})})},methods:{handleTotalPrice:function(){},fetchEvents:function(e,t){var a=this,t={start:e.format("MM/DD/YYYY"),end:t.format("MM/DD/YYYY"),id:bravo_booking_data.id,for_single:1};i.ajax({url:bravo_booking_i18n.load_dates_url,dataType:"json",type:"get",data:t,beforeSend:function(){i(".daterangepicker").addClass("loading")},success:function(e){a.allEvents=e;var t=i(a.$refs.start_date).data("daterangepicker");t.allEvents=e,t.renderCalendar("left"),t.singleDatePicker||t.renderCalendar("right"),i(".daterangepicker").removeClass("loading")},error:function(e){console.log(e),console.log("Can not get availability")}})},formatMoney:function(e){return window.bravo_format_money(e)},validate:function(){return this.start_date&&this.end_date?!!this.guests||(this.message.status=!1,this.message.content=bravo_booking_i18n.no_guest_select,!1):(this.message.status=!1,this.message.content=bravo_booking_i18n.no_date_select,!1)},addPersonType:function(e){if(this.guests>=bravo_booking_data.max_guests)return!1;switch(e){case"adults":this.adults++;break;case"children":this.children++}},minusPersonType:function(e){switch(e){case"adults":2<=this.adults&&this.adults--;break;case"children":1<=this.children&&this.children--}},doSubmit:function(e){if(e.preventDefault(),this.onSubmit)return!1;if(!this.validate())return!1;this.onSubmit=!0;var r=this;this.message.content="",1==this.step&&(this.html=""),i.ajax({url:bookingCore.url+"/booking/addToCart",data:{service_id:this.id,service_type:"space",start_date:this.start_date,end_date:this.end_date,extra_price:this.extra_price,adults:this.adults,children:this.children},dataType:"json",type:"post",success:function(e){if(e.status||(r.onSubmit=!1),e.message&&(r.message.content=e.message,r.message.type=e.status),e.step&&(r.step=e.step),e.html&&(r.html=e.html),e.url&&(window.location.href=e.url),e.errors&&"object"==typeof e.errors){var t,a="";for(t in e.errors)a+=e.errors[t]+"<br>";r.message.content=a}},error:function(e){console.log(e),r.onSubmit=!1,bravo_handle_error_response(e),401==e.status&&i(".bravo_single_book_wrap").modal("hide"),401!=e.status&&e.responseJSON&&(r.message.content=e.responseJSON.message||"Can not booking",r.message.type=!1)}})},doEnquirySubmit:function(e){if(e.preventDefault(),this.onSubmit)return!1;if(!this.validateenquiry())return!1;this.onSubmit=!0;var r=this;this.message.content="",i.ajax({url:bookingCore.url+"/booking/addEnquiry",data:{service_id:this.id,service_type:"space",name:this.enquiry_name,email:this.enquiry_email,phone:this.enquiry_phone,note:this.enquiry_note},dataType:"json",type:"post",success:function(e){if(e.message&&(r.message.content=e.message,r.message.type=e.status),e.errors&&"object"==typeof e.errors){var t,a="";for(t in e.errors)a+=e.errors[t]+"<br>";r.message.content=a}e.status&&(r.enquiry_is_submit=!0,r.enquiry_name="",r.enquiry_email="",r.enquiry_phone="",r.enquiry_note=""),r.onSubmit=!1},error:function(e){r.onSubmit=!1,bravo_handle_error_response(e),401==e.status&&i(".bravo_single_book_wrap").modal("hide"),401!=e.status&&e.responseJSON&&(r.message.content=e.responseJSON.message||"Can not booking",r.message.type=!1)}})},validateenquiry:function(){return this.enquiry_name?!!this.enquiry_email||(this.message.status=!1,this.message.content=bravo_booking_i18n.email_required,!1):(this.message.status=!1,this.message.content=bravo_booking_i18n.name_required,!1)},openStartDate:function(){i(this.$refs.start_date).trigger("click")}}}),i(window).on("load",function(){var e,t=window.location.href.split("#")[1];t&&i("."+t).length&&(e="review-list"===t?330:70,i("html,body").animate({scrollTop:i("."+t).offset().top-e},1e3))}),i(".bravo-button-book-mobile").on("click",function(){i(".bravo_single_book_wrap").modal("show")}),i(".bravo_detail_space .g-faq .item .header").on("click",function(){i(this).parent().toggleClass("active")})}(jQuery);